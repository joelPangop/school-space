# ---------- Stage 1: Build React App ----------
FROM node:20 AS build

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm ci

COPY . .

# Supprimer un √©ventuel build pr√©c√©dent
RUN rm -rf build

# üõ† Build et v√©rifier si build/ est cr√©√©
RUN REACT_APP_API_URL=$REACT_APP_API_URL npm run build && ls -al build

# ---------- Stage 2: Serve with Nginx ----------
FROM nginx:alpine

COPY --from=build /app/build /usr/share/nginx/html
COPY ./public/env-config.js /usr/share/nginx/html/env-config.js
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
